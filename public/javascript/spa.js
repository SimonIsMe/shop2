// Generated by CoffeeScript 1.4.0
(function() {
  var Main;

  $(function() {
    var app, main;
    main = new Main;
    app = Sammy(function() {
      this.get('#/', function() {
        var mainHtml, source, template;
        source = $("#home-page-tpl").html();
        template = Handlebars.compile(source);
        mainHtml = template();
        $('#content .row').html(mainHtml);
        main.createCategoriesList(0);
        return main.createCart();
      });
      this.get('#/category/:id', function() {
        var mainHtml, source, template;
        source = $("#category-tpl").html();
        template = Handlebars.compile(source);
        mainHtml = template({
          name: 'Nazwa kategorii'
        });
        $('#content .row').html(mainHtml);
        main.createCategoriesList(this.params['id']);
        main.getHtmlOfProductsTable(this.params['id']);
        return main.createCart();
      });
      this.get('#/product/:id', function() {
        var callback;
        callback = function(data) {
          var mainHtml, source, template;
          source = $("#product-tpl").html();
          template = Handlebars.compile(source);
          mainHtml = template({
            id: data.id,
            name: data.name,
            price: data.price,
            price_100: data.price * 100,
            buyer_id: 3
          });
          return $('#content .row').html(mainHtml);
        };
        $.get('/products/' + this.params['id'] + '.json', callback);
        return main.createCart();
      });
      this.get('#/search', function() {
        var callback;
        callback = function(data) {
          var html, source, template;
          console.log(data);
          source = $("#search-results-tpl").html();
          template = Handlebars.compile(source);
          html = template({
            products: data
          });
          $('#content .row').html(html);
          $('form#search input[name="search"]').val('');
          $('form#search input[name="price_from"]').val('');
          return $('form#search input[name="price_to"]').val('');
        };
        return $.get('/search.json?' + $('form#search').serialize(), callback);
      });
      this.post('#/orders/create', function() {
        $.post('/orders/', {
          buyer_id: this.params['buyer_id'],
          price: this.params['price'],
          product_id: this.params['product_id'],
          quantity: this.params['quantity']
        });
        return this.redirect('#/orders');
      });
      this.get('#/orders', function() {
        var callback;
        callback = function(data) {
          var html, source, template;
          source = $("#orders-tpl").html();
          template = Handlebars.compile(source);
          html = template({
            orders: data
          });
          console.log(html);
          return $('#content .row').html(html);
        };
        return $.get('/orders.json', callback);
      });
      return this.get('#/orders/:id/remove', function() {
        $.get('/orders/' + this.params['id'] + '/remove');
        return this.redirect('#/orders');
      });
    });
    app.run('#/');
    $('form').submit(function() {
      return false;
    });
    return $('form#search').unbind("submit");
  });

  Main = (function() {

    function Main() {}

    Main.prototype.createCategoriesList = function(categoryId) {
      var callback;
      callback = function(data) {
        var html, source, template;
        source = $("#categories-tpl").html();
        template = Handlebars.compile(source);
        html = template({
          categories: data
        });
        $('#categories-list').html(html);
        Main.prototype.updateCategoriesList(categoryId);
        return true;
      };
      return $.get('/categories/names.json', {}, callback, 'json');
    };

    Main.prototype.updateCategoriesList = function(categoryId) {
      $('#categories li').removeClass('active');
      if (categoryId === 0) {
        return $('#categories-list a[href="#/"]').parent().attr('class', 'active');
      } else {
        return $('#categories-list a[href="#/category/' + categoryId + '"]').parent().attr('class', 'active');
      }
    };

    Main.prototype.getHtmlOfProductsTable = function(categoryId) {
      var callback;
      callback = function(data) {
        var html, source, template;
        source = $("#products-table-tpl").html();
        template = Handlebars.compile(source);
        html = template({
          products: data
        });
        return $('#main table').html(html);
      };
      return $.get('/categories/' + categoryId + '.json', callback);
    };

    Main.prototype.createCart = function() {
      var callback;
      callback = function(data) {
        var html, source, template;
        source = $("#orders-right-tpl").html();
        template = Handlebars.compile(source);
        html = template({
          orders: data
        });
        return $('#right').html(html);
      };
      return $.get('/orders.json', callback);
    };

    return Main;

  })();

}).call(this);
